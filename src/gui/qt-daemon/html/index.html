<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html;" />

    <!--  <link rel="stylesheet" href="files/jquery-ui-1.10.2.custom.css" /> -->
    <link rel="stylesheet" href="files/css/start/jquery-ui-1.10.4.custom.css"/>
    <link rel="stylesheet" type="text/css" href="files/style.css" />

    <!--  <script src="files/http_code.jquery.com_jquery-latest.js"></script> -->
    <!--  <script src="files/http_code.jquery.com_ui_1.10.2_jquery-ui.js"></script> -->
    <script src="files/js/jquery-1.10.2.js"></script>
    <script src="files/js/jquery-ui-1.10.4.custom.js"></script>
    <script src="files/ui_helper.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>

<div id="container">
    <div id="main_menu_bar" class="inline_menu_bar">
        <div id="daemon_state_view_menu" class="inline_menu_bar_item"  view_name="daemon_state_view">Connectivity</div>
        <div id="wallet_view_menu"  class="inline_menu_bar_item" view_name="wallet_view">Open wallet</div>
    </div>

    <div id="daemon_state_view" class="view_hidden menu_view_inner_area" >
        <div class="daemon_view_general_status_block"><span class="daemon_view_general_status_text">Status:</span> <span  id="daemon_status_text">Loading blockchain data...</span></div>
        <div id="synchronization_progressbar_block">
            <div style="width: 200px; height: 20px;float: left;" id="synchronization_progressbar"></div><span style="margin-left: 10px;" id="daemon_synchronization_text">--</span>
        </div>
        <div class="daemon_view_details_block">
            <div class="daemon_view_details_status_block">
                <span class="daemon_view_param_title">Connections: </span>
                <span class="daemon_view_param_value" id="daemon_out_connections_text">0</span>  <!-- (out)/<span id="daemon_inc_connections_text">0</span>(inc)</span> -->
            </div>
            <div class="daemon_view_details_status_block">
                <span class="daemon_view_param_title">Height: </span>
                <span class="daemon_view_param_value" id="daemon_height_text">0</span>  <!-- (out)/<span id="daemon_inc_connections_text">0</span>(inc)</span> -->
            </div>
            <div class="daemon_view_details_status_block">
                <span class="daemon_view_param_title">Current difficulty: </span>
                <span class="daemon_view_param_value" id="difficulty_text">---</span>
            </div>
            <div class="daemon_view_details_status_block">
                <span class="daemon_view_param_title">Current network hashrate: </span>
                <span class="daemon_view_param_value" id="hashrate_text">---</span>
            </div>
        </div>
        <div id="open_wallet_button" class="common_button">Open wallet</div>
    </div>
    <div id="wallet_view" class="view_hidden menu_view_inner_area" >
        <div class="small_text">wallet text area</div>
    </div>
</div>

<script type="text/javascript">

function on_update_daemon_state(daemon_info_str)
{
    var info_obj = jQuery.parseJSON(daemon_info_str);

    if(info_obj.daemon_network_state == 0)//daemon_network_state_connecting
    {
        //do nothing
    }else if(info_obj.daemon_network_state == 1)//daemon_network_state_synchronizing
    {
        var percents = 0;
        if (info_obj.max_net_seen_height > info_obj.synchronization_start_height)
         percents = ((info_obj.height - info_obj.synchronization_start_height)*100)/(info_obj.max_net_seen_height - info_obj.synchronization_start_height);
        $("#synchronization_progressbar").progressbar( "option", "value", percents );
        $("#daemon_synchronization_text").text((info_obj.max_net_seen_height - info_obj.height).toString() + " blocks behind");
        //show progress
    }else if(info_obj.daemon_network_state == 2)//daemon_network_state_online
    {
        $("#synchronization_progressbar_block").hide();
        $("#daemon_status_text").addClass("daemon_view_general_status_value_success_text");
        $("#open_wallet_button").button("enable");
        //show OK
    }else if(info_obj.daemon_network_state == 3)//daemon_network_state_online
    {
        $("#synchronization_progressbar_block").show();
        $("#synchronization_progressbar" ).progressbar({value: false });
        $("#daemon_synchronization_text").text("");

        $("#daemon_status_text").removeClass("daemon_view_general_status_value_success_text");
        $("#open_wallet_button").button("disable");
        //show OK
    }
    else
    {
        //set unknown status
        $("#daemon_status_text").text("Unkonwn state");
        return;
    }

    $("#daemon_status_text").text(info_obj.text_state);

    $("#daemon_out_connections_text").text(info_obj.out_connections_count.toString());
    if(info_obj.out_connections_count >= 8)
    {
        $("#daemon_out_connections_text").addClass("daemon_view_general_status_value_success_text");
    }
    //$("#daemon_inc_connections_text").text(info_obj.inc_connections_count.toString());

    $("#daemon_height_text").text(info_obj.height.toString());
    $("#difficulty_text").text(info_obj.difficulty);
    $("#hashrate_text").text(info_obj.hashrate.toString());
}

$(function()
{ // DOM ready
    $( "#synchronization_progressbar" ).progressbar({value: false });
    $(".common_button").button();
    $("#open_wallet_button").button("disable");
    Qt.update_daemon_state.connect(on_update_daemon_state); // Connect signal sent from Qt to javascript function
});

</script>
</body>
</html>
